<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>JUNIOR PRIVATE HUB | Final Matrix</title>
    <style>
        :root { --gold: #D4AF37; --milk: #fcfcfc; --bg: #050505; --black: #000000; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; }
        .hub-container { max-width: 450px; margin: auto; border: 2.2px solid var(--gold); padding: 20px; border-radius: 25px; background: #000; box-shadow: 0 0 30px rgba(212,175,55,0.2); }
        
        /* Chat Matrix */
        .chat-matrix { height: 480px; overflow-y: auto; display: flex; flex-direction: column; background: #0a0a0a; padding: 12px; border-radius: 15px; border: 1px solid #1a1a1a; margin-bottom: 15px; }
        .bubble { padding: 12px; border-radius: 18px; margin: 6px 0; max-width: 82%; color: #000; font-weight: 500; position: relative; }
        .sender-name { font-size: 0.6rem; font-weight: bold; margin-bottom: 3px; display: block; text-transform: uppercase; }

        /* Login Options */
        .login-card { background: #111; padding: 15px; border-radius: 15px; border: 1px solid #222; margin-bottom: 20px; text-align: center; }
        .btn { padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; text-transform: uppercase; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-milk { background: var(--milk); color: #000; }
        .btn-red { background: #ff3131; color: #fff; }
        
        input, textarea { width: 92%; padding: 14px; background: #000; border: 1.5px solid #333; color: #fff; border-radius: 12px; margin-bottom: 10px; text-align: center; }
        .media-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
    </style>
</head>
<body class="notranslate">

<div class="hub-container">
    <h2 style="color:var(--gold); text-align:center;">JUNIOR PRIVATE HUB üõ°Ô∏è</h2>

    <div id="loginScreen">
        <div class="login-card" style="border-color: var(--gold);">
            <p style="color:var(--gold); font-size:0.75rem; margin-bottom:10px;">üÜï ANZA CHUMBA KIPYA (Code: 1234)</p>
            <input type="password" id="initCode" placeholder="Ingiza 1234">
            <button class="btn btn-gold" onclick="startNewSetup()">FUNGUA SETUP MPYA</button>
        </div>

        <div class="login-card">
            <p style="color:#aaa; font-size:0.75rem; margin-bottom:10px;">üîê MMILIKI (OWNER VAULT)</p>
            <input type="password" id="ownerPass" placeholder="Weka Password Yako">
            <button class="btn btn-gold" onclick="loginOwner()">FUNGUA SANDUKU LAKO</button>
        </div>

        <div class="login-card">
            <p style="color:var(--milk); font-size:0.75rem; margin-bottom:10px;">üë§ ALIYEALIKWA (GUEST)</p>
            <input type="text" id="guestName" placeholder="Andika Jina Lako">
            <input type="text" id="guestRoomCode" placeholder="Ingiza Kodi ya Chumba">
            <button class="btn btn-milk" onclick="loginGuest()">INGIA KWENYE CHAT</button>
        </div>
    </div>

    <div id="setupScreen" style="display:none;">
        <h3 style="color:var(--gold);">NEW ROOM CONFIG</h3>
        <input type="text" id="setupRoomName" placeholder="Jina la Chumba">
        <input type="password" id="setupRoomPass" placeholder="Weka Password Mpya ya Kudumu">
        <button class="btn btn-gold" onclick="finalizeSetup()">SAVE & CREATE ROOM</button>
    </div>

    <div id="registryScreen" style="display:none;">
        <h4 style="color:var(--gold);">ORODHA YA VYUMBA VYAKO</h4>
        <div id="roomList"></div>
        <button class="btn btn-red" onclick="location.reload()">LOGOUT & LOCK</button>
    </div>

    <div id="chatScreen" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
            <span id="headerName" style="color:var(--gold); font-size:0.8rem; font-weight:bold;"></span>
            <button class="btn btn-red" style="width:auto; padding:5px 12px; margin:0;" onclick="goBack()">BACK</button>
        </div>
        
        <div class="chat-matrix" id="matrix"></div>
        
        <div class="media-btns">
            <button class="btn" style="background:#333; color:#fff;" onclick="document.getElementById('picIn').click()">üì∑ PICHA</button>
            <button class="btn" style="background:#333; color:#fff;" onclick="sendLocation()">üìç MAPS</button>
        </div>
        
        <input type="file" id="picIn" style="display:none" accept="image/*" onchange="uploadPic(this)">
        <textarea id="msgInput" placeholder="Andika ujumbe..."></textarea>
        <button class="btn btn-gold" id="sendBtn">TUMA UJUMBE</button>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('JUNIOR_FINAL_DATABASE_V3') || '{"users":{}}');
    let currentPass = "";
    let currentRoom = "";
    let myIdentity = "";
    const userColors = ["#D4AF37", "#fcfcfc", "#3498db", "#2ecc71", "#e67e22", "#9b59b6", "#1abc9c"];

    function save() { localStorage.setItem('JUNIOR_FINAL_DATABASE_V3', JSON.stringify(db)); }

    // --- LOGINS ---
    function startNewSetup() {
        if(document.getElementById('initCode').value === "1234") {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
        } else { alert("Tumia 1234 pekee!"); }
    }

    function loginOwner() {
        currentPass = document.getElementById('ownerPass').value;
        if(!db.users[currentPass]) return alert("Password hii haina Sanduku!");
        myIdentity = "MMILIKI";
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('registryScreen').style.display = 'block';
        renderRooms();
    }

    function loginGuest() {
        myIdentity = document.getElementById('guestName').value;
        currentRoom = document.getElementById('guestRoomCode').value;
        if(!myIdentity || !currentRoom) return alert("Jaza Jina na Kodi!");
        if(!findRoom(currentRoom)) return alert("Chumba hiki hakipo!");
        startChat();
    }

    // --- SETUP & REGISTRY ---
    function finalizeSetup() {
        const name = document.getElementById('setupRoomName').value;
        const pass = document.getElementById('setupRoomPass').value;
        if(!name || !pass || pass === "1234") return alert("Jaza taarifa sahihi (Password isiwe 1234)!");
        
        db.users[pass] = { rooms: {} };
        const code = 'T-Junior/' + Math.random().toString(36).substr(2, 5).toUpperCase();
        db.users[pass].rooms[code] = { name: name, chats: [] };
        save();
        alert("Chumba Kimeundwa! Kodi yako ya kudumu ni: " + pass);
        location.reload();
    }

    function renderRooms() {
        const list = document.getElementById('roomList'); list.innerHTML = "";
        const rooms = db.users[currentPass].rooms;
        for(let c in rooms) {
            list.innerHTML += `<div style="background:#111; padding:15px; border-radius:12px; border-left:5px solid var(--gold); margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                <div><b>${rooms[c].name}</b><br><small>${c}</small></div>
                <button class="btn btn-gold" style="width:auto; padding:8px 15px;" onclick="enterRoom('${c}')">INGIA</button>
            </div>`;
        }
    }

    function enterRoom(c) { currentRoom = c; startChat(); }

    // --- CHAT CORE ---
    function startChat() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('registryScreen').style.display = 'none';
        document.getElementById('chatScreen').style.display = 'block';
        document.getElementById('headerName').innerText = "ROOM: " + currentRoom;
        document.getElementById('sendBtn').onclick = () => pushMsg();
        loadMsgs();
    }

    function findRoom(c) {
        for(let u in db.users) { if(db.users[u].rooms[c]) return db.users[u].rooms[c]; }
        return null;
    }

    function loadMsgs() {
        const matrix = document.getElementById('matrix');
        const room = findRoom(currentRoom);
        matrix.innerHTML = room.chats.map(chat => {
            const color = userColors[Math.abs(hash(chat.u)) % 7];
            const align = chat.u === myIdentity ? 'flex-start' : 'flex-end';
            return `<div class="bubble" style="background:${color}; align-self:${align}">
                <span class="sender-name">${chat.u}</span>${chat.t}
                <div style="font-size:0.5rem; opacity:0.6; text-align:right;">${new Date(chat.tm).toLocaleTimeString()}</div>
            </div>`;
        }).join('');
        matrix.scrollTop = matrix.scrollHeight;
    }

    function pushMsg() {
        const txt = document.getElementById('msgInput').value; if(!txt) return;
        findRoom(currentRoom).chats.push({ t: txt, u: myIdentity, tm: Date.now() });
        save(); loadMsgs(); document.getElementById('msgInput').value = "";
    }

    function uploadPic(input) {
        if (input.files[0]) {
            const r = new FileReader();
            r.onload = (e) => {
                findRoom(currentRoom).chats.push({ t: `<img src="${e.target.result}" style="max-width:100%; border-radius:8px;">`, u: myIdentity, tm: Date.now() });
                save(); loadMsgs();
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    function sendLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => {
                const url = `https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
                findRoom(currentRoom).chats.push({ t: `üìç <a href="${url}" target="_blank" style="color:blue; font-weight:bold;">NIPO HAPA (BONYEZA MAPS)</a>`, u: myIdentity, tm: Date.now() });
                save(); loadMsgs();
            });
        }
    }

    function hash(s) { let h = 0; for(let i=0; i<s.length; i++) h = s.charCodeAt(i) + ((h << 5) - h); return h; }
    function goBack() { myIdentity === "MMILIKI" ? (document.getElementById('chatScreen').style.display='none', document.getElementById('registryScreen').style.display='block') : location.reload(); }
</script>
</body>
</html>
