<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>JUNIOR PRIVAT HUB | Secure Hub</title>
    <style>
        :root { --gold: #D4AF37; --white: #F5F5F5; --green: #00FF41; --bg: #000000; --red: #FF3131; }
        body { background: var(--bg); color: var(--white); font-family: 'Courier New', monospace; margin: 0; padding: 10px; }
        .hub-container { max-width: 480px; margin: auto; border: 2px solid var(--gold); padding: 15px; border-radius: 20px; text-align: center; }
        
        /* Chat Matrix bubbles */
        .msg-container { display: flex; flex-direction: column; height: 350px; overflow-y: auto; padding: 10px; background: #050505; border: 1px solid #222; border-radius: 12px; margin-bottom: 10px; }
        .owner-msg { align-self: flex-start; background: #111; color: var(--green); border: 1px solid var(--green); padding: 10px; border-radius: 10px 10px 10px 0; margin: 5px 0; max-width: 80%; }
        .guest-msg { align-self: flex-end; background: #222; color: var(--white); border: 1px solid #eee; padding: 10px; border-radius: 10px 10px 0 10px; margin: 5px 0; max-width: 80%; }
        
        /* Interactive Buttons */
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.7rem; margin-top: 5px; }
        .btn-gold { background: var(--gold); color: #000; width: 100%; }
        .btn-red { background: var(--red); color: #fff; width: 100%; }
        .btn-white { background: var(--white); color: #000; width: 100%; }
        .btn-green { background: var(--green); color: #000; }
        
        input, textarea { width: 90%; padding: 12px; background: #000; border: 1px solid #333; color: white; border-radius: 8px; margin-bottom: 10px; text-align: center; }
        .info-box { background: rgba(0,255,65,0.1); border: 1px solid var(--green); padding: 10px; border-radius: 10px; font-size: 0.75rem; color: var(--green); margin-bottom: 10px; }
    </style>
</head>
<body class="notranslate">

<div class="hub-container" id="app">
    <h1 style="color:var(--gold); margin-bottom:5px;">JUNIOR PRIVAT HUB üõ°Ô∏è</h1>
    
    <div id="loginSection">
        <h3 style="font-size:0.8rem;">üîí INGIA KWENYE BOX LAKO</h3>
        <input type="password" id="masterKey" placeholder="Weka Passcode Yako">
        <button class="btn btn-gold" onclick="openVault()">FUNGUA VAULT</button>
        <p style="font-size:0.6rem; color:#555; margin-top:15px;">Ukisahau password, funguo zako hazitaonekana milele.</p>
    </div>

    <div id="registrySection" style="display:none;">
        <div class="info-box" id="guideText">
            Karibu! Hapa ndipo unahifadhi funguo zako za siri. Hakuna mwingine anayeziona.
        </div>
        <div style="background:#111; padding:15px; border-radius:12px; border:1px solid var(--gold);">
            <h4 style="color:var(--gold); margin:0 0 10px 0;">üîë BOX LAKO LA FUNGUO</h4>
            <div id="keysDisplay" style="text-align:left; margin-bottom:15px;"></div>
            
            <input type="text" id="newRoomName" placeholder="Jina la Room (Mfn: Faisal)">
            <button class="btn btn-green" onclick="createRoom()">GENERATE NEW ROOM</button>
        </div>
        <button class="btn btn-red" onclick="location.reload()">LOGOUT & LOCK</button>
    </div>

    <div id="ownerChat" style="display:none;">
        <h4 id="roomTitleOwner" style="color:var(--gold);"></h4>
        <div class="msg-container" id="matrixOwner"></div>
        <textarea id="msgOwner" placeholder="Andika ujumbe (Owner)..."></textarea>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
            <button class="btn btn-green" onclick="send('first')">SEND & SAVE</button>
            <button class="btn btn-red" onclick="closeChat()">BACK</button>
        </div>
    </div>

    <div id="guestChat" style="display:none;">
        <h4 id="roomTitleGuest" style="color:var(--white);"></h4>
        <div class="msg-container" id="matrixGuest"></div>
        <textarea id="msgGuest" placeholder="Jibu ujumbe hapa (Guest)..."></textarea>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
            <button class="btn btn-white" onclick="send('second')">REPLY GUEST</button>
            <button class="btn btn-red" onclick="location.reload()">EXIT</button>
        </div>
    </div>
</div>

<script>
    let userPass = "";
    let currentCode = "";
    
    // 1. Kufungua Vault Binafsi
    function openVault() {
        userPass = document.getElementById('masterKey').value;
        if(!userPass) return alert("Weka Passcode!");
        
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('registrySection').style.display = 'block';
        renderKeys();
    }

    // 2. Kutengeneza Room (Inajihifadhi chini ya Password ya mtumiaji)
    function createRoom() {
        const name = document.getElementById('newRoomName').value;
        if(!name) return;
        
        const code = 'T-Junior/' + Math.random().toString(36).substr(2, 6).toUpperCase();
        let allData = JSON.parse(localStorage.getItem('j_hub_vault') || '{}');
        
        // Tunahifadhi kwa kupanga kulingana na Password
        if(!allData[userPass]) allData[userPass] = { rooms: {} };
        allData[userPass].rooms[code] = { name: name, chats: [] };
        
        localStorage.setItem('j_hub_vault', JSON.stringify(allData));
        document.getElementById('newRoomName').value = "";
        
        alert("Room imetengenezwa!\nKODI: " + code + "\nMtumie rafiki yako kodi hii.");
        renderKeys();
    }

    // 3. Kuonyesha funguo za mtumiaji HUYU tu
    function renderKeys() {
        const display = document.getElementById('keysDisplay');
        let allData = JSON.parse(localStorage.getItem('j_hub_vault') || '{}');
        display.innerHTML = "";
        
        if(allData[userPass] && allData[userPass].rooms) {
            for(let code in allData[userPass].rooms) {
                display.innerHTML += `
                    <div style="padding:10px; background:#1a1a1a; margin-bottom:8px; border-radius:8px; border-left:4px solid var(--gold); display:flex; justify-content:space-between; align-items:center;">
                        <div><b>${allData[userPass].rooms[code].name}</b><br><small>${code}</small></div>
                        <button class="btn btn-green" style="width:auto; padding:5px 10px;" onclick="openOwnerChat('${code}')">OPEN</button>
                    </div>`;
            }
        } else {
            display.innerHTML = "<p style='font-size:0.7rem; color:#666;'>Sanduku lako la funguo ni tupu.</p>";
        }
    }

    // 4. Kuingia kama Owner
    function openOwnerChat(code) {
        currentCode = code;
        document.getElementById('registrySection').style.display = 'none';
        document.getElementById('ownerChat').style.display = 'block';
        document.getElementById('roomTitleOwner').innerText = "OWNER VAULT: " + code;
        loadMessages('matrixOwner');
    }

    // 5. Kuingia kama Guest (Mtu mwingine mwenye kodi)
    // Hapa Admin anaweza kuongeza kitufe cha 'Join as Guest' mwanzo
    function loadMessages(containerId) {
        let allData = JSON.parse(localStorage.getItem('j_hub_vault') || '{}');
        let roomData = null;
        
        // Tafuta room kwenye database nzima kwa kutumia kodi
        for(let pass in allData) {
            if(allData[pass].rooms[currentCode]) roomData = allData[pass].rooms[currentCode];
        }

        if(roomData) {
            const box = document.getElementById(containerId);
            box.innerHTML = roomData.chats.map(c => `
                <div class="${c.u === 'first' ? 'owner-msg' : 'guest-msg'}">
                    ${c.t}
                </div>`).join('');
            box.scrollTop = box.scrollHeight;
        }
    }

    function send(userType) {
        const inputId = userType === 'first' ? 'msgOwner' : 'msgGuest';
        const containerId = userType === 'first' ? 'matrixOwner' : 'matrixGuest';
        const text = document.getElementById(inputId).value;
        if(!text) return;

        let allData = JSON.parse(localStorage.getItem('j_hub_vault') || '{}');
        for(let pass in allData) {
            if(allData[pass].rooms[currentCode]) {
                allData[pass].rooms[currentCode].chats.push({ t: text, u: userType });
            }
        }
        localStorage.setItem('j_hub_vault', JSON.stringify(allData));
        document.getElementById(inputId).value = "";
        loadMessages(containerId);
    }

    function closeChat() {
        document.getElementById('ownerChat').style.display = 'none';
        document.getElementById('registrySection').style.display = 'block';
    }
</script>
</body>
</html>
