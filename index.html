<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>JUNIOR PRIVATE HUB | Permanent Vault</title>
    <style>
        :root { --gold: #D4AF37; --milk: #fcfcfc; --black: #000000; --bg: #050505; --red: #ff3131; --blue: #1e90ff; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 10px; }
        .hub-container { max-width: 450px; margin: auto; border: 2px solid var(--gold); padding: 15px; border-radius: 25px; text-align: center; background: #000; }
        
        /* Message Matrix */
        .matrix-box { height: 450px; overflow-y: auto; display: flex; flex-direction: column; background: #0a0a0a; padding: 12px; border-radius: 15px; border: 1px solid #1a1a1a; margin-bottom: 10px; }
        
        /* Owner: Gold/Black */
        .owner-bubble { align-self: flex-start; background: var(--gold); color: var(--black); padding: 12px; border-radius: 18px 18px 18px 2px; margin: 8px 0; max-width: 80%; text-align: left; font-weight: 600; box-shadow: 2px 2px 10px rgba(212,175,55,0.2); }
        
        /* Guest: Milk White/Black */
        .guest-bubble { align-self: flex-end; background: var(--milk); color: var(--black); padding: 12px; border-radius: 18px 18px 2px 18px; margin: 8px 0; max-width: 80%; text-align: left; font-weight: 500; box-shadow: -2px 2px 10px rgba(255,255,255,0.1); }

        .btn { padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; width: 100%; margin-top: 10px; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: var(--black); }
        .btn-milk { background: var(--milk); color: var(--black); }
        .btn-red { background: var(--red); color: #fff; }

        input, textarea { width: 90%; padding: 14px; background: #111; border: 1px solid #333; color: white; border-radius: 12px; margin-bottom: 12px; }
        .tools { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        img { max-width: 100%; border-radius: 12px; border: 1px solid var(--gold); margin-top: 5px; }
    </style>
</head>
<body class="notranslate">

<div class="hub-container">
    <h2 style="color:var(--gold); margin-bottom:20px;">JUNIOR PRIVATE HUB üõ°Ô∏è</h2>

    <div id="startScreen">
        <input type="password" id="vaultPass" placeholder="Weka Passcode (1234)">
        <button class="btn btn-gold" onclick="openVault()">FUNGUA SANDUKU LAKO</button>
        <div style="margin: 25px 0; border-top: 1px solid #222; padding-top: 20px;">
            <input type="text" id="guestCode" placeholder="Ingiza Kodi ya Rafiki">
            <button class="btn btn-milk" onclick="enterAsGuest()">INGIA KAMA GUEST</button>
        </div>
    </div>

    <div id="registryScreen" style="display:none;">
        <h3 style="color:var(--gold); font-size: 1rem;">üóÉÔ∏è ROOM REGISTRY (PERMANENT)</h3>
        <div id="roomList" style="text-align:left; margin-bottom:20px;"></div>
        <input type="text" id="newRoomName" placeholder="Jina la Room Mpya">
        <button class="btn btn-gold" onclick="createNewRoom()">SAVE & GENERATE ROOM</button>
        <button class="btn btn-red" onclick="location.reload()">LOGOUT & LOCK</button>
    </div>

    <div id="chatScreen" style="display:none;">
        <p id="activeInfo" style="font-size:0.75rem; color:var(--gold); margin-bottom:8px;"></p>
        <div class="matrix-box" id="matrix"></div>
        
        <div class="tools">
            <button class="btn btn-gold" style="font-size:0.7rem;" onclick="document.getElementById('fileIn').click()">üì∑ PICHA</button>
            <button class="btn btn-milk" style="font-size:0.7rem;" onclick="shareLocation()">üìç MAPS</button>
        </div>
        
        <input type="file" id="fileIn" style="display:none" accept="image/*" onchange="handleImg(this)">
        <textarea id="msgInput" placeholder="Andika hapa..."></textarea>
        
        <div id="sendContainer"></div>
        <button class="btn btn-red" style="width:40%; margin-top:15px; font-size:0.6rem;" onclick="backToMenu()">RUDI NYUMA</button>
    </div>
</div>

<script>
    // Database ya kudumu
    let db = JSON.parse(localStorage.getItem('JUNIOR_FINAL_STORAGE') || '{"users":{}}');
    let currentPass = "";
    let currentRoom = "";
    let userRole = "";

    function saveDB() { localStorage.setItem('JUNIOR_FINAL_STORAGE', JSON.stringify(db)); }

    function openVault() {
        currentPass = document.getElementById('vaultPass').value || "1234";
        if(!db.users[currentPass]) db.users[currentPass] = { rooms: {} };
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('registryScreen').style.display = 'block';
        renderRooms();
    }

    function enterAsGuest() {
        currentRoom = document.getElementById('guestCode').value;
        if(!currentRoom) return alert("Weka kodi!");
        userRole = 'second';
        initChat();
    }

    function createNewRoom() {
        const name = document.getElementById('newRoomName').value;
        if(!name) return;
        const code = 'T-Junior/' + Math.random().toString(36).substr(2, 5).toUpperCase();
        db.users[currentPass].rooms[code] = { name: name, chats: [] };
        saveDB(); renderRooms();
        document.getElementById('newRoomName').value = "";
    }

    function renderRooms() {
        const list = document.getElementById('roomList');
        list.innerHTML = "";
        const rooms = db.users[currentPass].rooms;
        for(let code in rooms) {
            list.innerHTML += `
                <div style="background:#111; padding:15px; border-radius:12px; border-left:5px solid var(--gold); margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-size:0.85rem;"><b>${rooms[code].name}</b><br><small style="color:#666">${code}</small></div>
                    <button class="btn btn-gold" style="width:auto; padding:8px 15px;" onclick="userRole='first'; currentRoom='${code}'; initChat()">OPEN</button>
                </div>`;
        }
    }

    function initChat() {
        document.getElementById('registryScreen').style.display = 'none';
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('chatScreen').style.display = 'block';
        document.getElementById('activeInfo').innerText = "PRIVATE VAULT: " + currentRoom;
        
        const sc = document.getElementById('sendContainer');
        sc.innerHTML = userRole === 'first' 
            ? `<button class="btn btn-gold" onclick="pushMsg('first')">SEND AS OWNER</button>`
            : `<button class="btn btn-milk" onclick="pushMsg('second')">REPLY AS GUEST</button>`;
        
        loadMsgs();
    }

    function findRoom(code) {
        for(let u in db.users) { if(db.users[u].rooms[code]) return db.users[u].rooms[code]; }
        return null;
    }

    function loadMsgs() {
        const matrix = document.getElementById('matrix');
        const room = findRoom(currentRoom);
        if(!room) { matrix.innerHTML = "Chumba hakipo au kimefutwa!"; return; }
        
        matrix.innerHTML = room.chats.map(c => `
            <div class="${c.r === 'first' ? 'owner-bubble' : 'guest-bubble'}">
                ${c.t}
                <div style="font-size:0.5rem; margin-top:5px; opacity:0.6; text-align:right;">${new Date(c.time).toLocaleTimeString()}</div>
            </div>`).join('');
        matrix.scrollTop = matrix.scrollHeight;
    }

    function pushMsg(roleType) {
        const text = document.getElementById('msgInput').value;
        if(!text) return;
        const room = findRoom(currentRoom);
        if(room) {
            room.chats.push({ t: text, r: roleType, time: Date.now() });
            saveDB(); loadMsgs();
            document.getElementById('msgInput').value = "";
        }
    }

    function handleImg(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const room = findRoom(currentRoom);
                room.chats.push({ t: `<img src="${e.target.result}">`, r: userRole, time: Date.now() });
                saveDB(); loadMsgs();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function shareLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((p) => {
                const url = `https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
                const room = findRoom(currentRoom);
                room.chats.push({ t: `üìç Mahali Nilipo: <a href="${url}" target="_blank" style="color:inherit; font-weight:bold;">BONYEZA MAPS</a>`, r: userRole, time: Date.now() });
                saveDB(); loadMsgs();
            });
        }
    }

    function backToMenu() {
        if(userRole === 'first') {
            document.getElementById('chatScreen').style.display = 'none';
            document.getElementById('registryScreen').style.display = 'block';
        } else { location.reload(); }
    }
</script>
</body>
</html>
