<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUNIOR HUB | SECURE SESSION</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-classic.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-classic.js"></script>

    <style>
        :root { 
            --soft-green: #2ea44f; 
            --dark-bg: #0d1117; 
            --panel: #161b22; 
            --text-main: #c9d1d9;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background: var(--dark-bg); color: var(--text-main); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* LOGIN SCREEN */
        #login-screen { position: fixed; inset: 0; background: #010409; display: flex; align-items: center; justify-content: center; z-index: 1000; flex-direction: column; }
        .gate-box { border: 1px solid #30363d; padding: 30px; border-radius: 12px; background: var(--panel); text-align: center; width: 85%; max-width: 360px; box-shadow: 0 8px 24px rgba(0,0,0,0.5); }
        
        input { width: 100%; background: #0d1117; border: 1px solid #30363d; padding: 12px; margin: 8px 0; color: white; border-radius: 6px; outline: none; box-sizing: border-box; }
        .btn-access { width: 100%; padding: 12px; background: var(--soft-green); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        
        .guest-info { margin-top: 20px; font-size: 13px; color: #8b949e; }
        .guest-info span { color: var(--soft-green); cursor: pointer; text-decoration: underline; }

        /* HUB INTERFACE */
        #hub-interface { display: none; flex-direction: column; height: 100vh; }
        .top-nav { background: var(--panel); padding: 15px; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
        #chat-flow { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #0d1117; }
        
        .bubble { padding: 10px 15px; border-radius: 15px; max-width: 80%; font-size: 14px; line-height: 1.4; }
        .my-side { align-self: flex-end; background: #238636; color: white; border-bottom-right-radius: 2px; }
        .other-side { align-self: flex-start; background: #30363d; color: white; border-bottom-left-radius: 2px; }

        .input-area { background: var(--panel); padding: 15px; display: flex; align-items: center; gap: 10px; border-top: 1px solid #30363d; }
        #msg-field { flex: 1; background: #010409; border: 1px solid #30363d; padding: 10px 15px; color: white; border-radius: 20px; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="gate-box">
        <h2 style="color: var(--soft-green); margin-bottom: 5px;">Junior Private Hub</h2>
        <p style="font-size: 12px; color: #8b949e; margin-bottom: 20px;">Secure End-to-End Encryption</p>
        
        <input type="text" id="alias" placeholder="Jina lako (Identity)">
        <input type="text" id="roomKey" placeholder="Password ya Chumba">
        <button class="btn-access" onclick="enterHub()">INGIA CHUMBANI</button>
        
        <div class="guest-info">
            Huna password? <span onclick="alert('Tengeneza password yako mwenyewe hapo juu na uwaambie marafiki zako wajaze hiyo hiyo ili muingie chumba kimoja!')">Tengeneza Chumba chako</span>
        </div>
    </div>
</div>

<div id="hub-interface">
    <div class="top-nav">
        <span style="font-size: 13px;">ROOM: <b id="display-room" style="color:var(--soft-green)"></b></span>
        <button onclick="location.reload()" style="background:none; border:none; color:#f85149; cursor:pointer;">LOGOUT</button>
    </div>
    <div id="chat-flow"></div>
    <div class="input-area">
        <label style="font-size: 20px; cursor: pointer;">ðŸ“Ž<input type="file" style="display:none" onchange="uploadMedia(this)"></label>
        <input type="text" id="msg-field" placeholder="Andika ujumbe...">
        <button onclick="sendMsg()" style="background:none; border:none; color:var(--soft-green); font-weight:bold; cursor:pointer;">TUMA</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBY_Tgf5XhAfAR7sgE7SVPYSU1QjkWvh6Y",
        authDomain: "privet-house--room.firebaseapp.com",
        databaseURL: "https://privet-house--room-default-rtdb.firebaseio.com",
        projectId: "privet-house--room",
        storageBucket: "privet-house--room.firebasestorage.app",
        messagingSenderId: "528726280084",
        appId: "1:528726280084:web:96dc8caa7b1c082527f181"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentUser, currentRoom;

    function enterHub() {
        currentUser = document.getElementById("alias").value.trim();
        currentRoom = document.getElementById("roomKey").value.trim();

        if(!currentUser || !currentRoom) {
            return alert("Tafadhali jaza Jina na Password!");
        }

        document.getElementById("login-screen").style.display = "none";
        document.getElementById("hub-interface").style.display = "flex";
        document.getElementById("display-room").innerText = currentRoom;

        db.ref("rooms/" + currentRoom).on("value", (snapshot) => {
            const flow = document.getElementById("chat-flow");
            flow.innerHTML = "";
            snapshot.forEach((child) => {
                const data = child.val();
                const div = document.createElement("div");
                div.className = `bubble ${data.u === currentUser ? 'my-side' : 'other-side'}`;
                
                let content = `<small style="opacity:0.7; font-size:10px;">${data.u}</small><br>`;
                if(data.t === "txt") content += `<span>${data.c}</span>`;
                if(data.t === "img") content += `<img src="${data.c}" style="max-width:100%; border-radius:8px; margin-top:5px;">`;
                
                div.innerHTML = content;
                flow.appendChild(div);
            });
            flow.scrollTop = flow.scrollHeight;
        });
    }

    function sendMsg() {
        const msg = document.getElementById("msg-field");
        if(msg.value.trim()) {
            db.ref("rooms/" + currentRoom).push({ u: currentUser, c: msg.value, t: "txt" });
            msg.value = "";
        }
    }

    function uploadMedia(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            db.ref("rooms/" + currentRoom).push({ u: currentUser, c: e.target.result, t: "img" });
        };
        reader.readAsDataURL(file);
    }
</script>
</body>
</html>
